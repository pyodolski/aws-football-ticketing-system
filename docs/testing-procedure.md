# 📋 4장: 부하 테스트 실행 절차 (상세 가이드)

## 🎯 테스트 개요

### 목적

- GCP 오토스케일링 동작 검증
- 로드밸런서 트래픽 분산 확인
- 시스템 성능 및 안정성 측정
- 실제 운영 환경 시뮬레이션

### 예상 소요 시간

- 준비: 30분
- 테스트 실행: 20-30분
- 스크린샷 촬영: 10분
- 총 소요 시간: 약 1시간

---

## 📅 테스트 일정

### D-Day (테스트 당일)

#### 오전 (준비 단계)

- 09:00 - 09:10: Cloud SQL 시작
- 09:10 - 09:20: 인스턴스 그룹 시작
- 09:20 - 09:30: 서비스 접속 확인 및 최종 점검

#### 오후 (테스트 실행)

- 14:00 - 14:10: 초기 상태 스크린샷 촬영
- 14:10 - 14:40: 부하 테스트 실행 및 모니터링
- 14:40 - 15:00: 스케일 다운 관찰
- 15:00 - 15:10: 인프라 구성 스크린샷 촬영

---

## 🔧 Step 1: 사전 준비 (30분)

### 1.1 Cloud SQL 시작 (5-10분)

#### 절차:

1. **GCP Console 접속**

   ```
   https://console.cloud.google.com
   ```

2. **SQL 메뉴로 이동**

   - 왼쪽 메뉴 → **SQL**
   - 또는 검색창에 "SQL" 입력

3. **인스턴스 시작**

   - Cloud SQL 인스턴스 선택
   - 상단의 **시작** 버튼 클릭
   - 확인 대화상자에서 **시작** 클릭

4. **시작 완료 대기**
   - 상태가 "실행 중"으로 변경될 때까지 대기
   - 약 5-10분 소요
   - 상태 표시: 🟢 실행 중

#### 확인 사항:

- ✅ 상태: 실행 중
- ✅ 연결 이름 확인
- ✅ 공개 IP 주소 확인

---

### 1.2 인스턴스 그룹 시작 (10분)

#### 절차:

1. **Compute Engine 메뉴로 이동**

   - 왼쪽 메뉴 → **Compute Engine** → **인스턴스 그룹**

2. **인스턴스 그룹 수정**

   - `football-app-group-v2` 선택
   - 상단의 **수정** 버튼 클릭

3. **자동 확장 설정 변경**

   ```
   최소 인스턴스 수: 0 → 2
   최대 인스턴스 수: 0 → 5
   ```

4. **저장**

   - 하단의 **저장** 버튼 클릭

5. **인스턴스 생성 대기**
   - **멤버** 탭으로 이동
   - 인스턴스 2개 생성 확인
   - 약 5-10분 소요
   - 상태: 🟢 정상

#### 확인 사항:

- ✅ 인스턴스 개수: 2개
- ✅ 모든 인스턴스 상태: 정상
- ✅ 내부 IP: 10.0.1.x 범위
- ✅ 외부 IP: 없음 (프라이빗)

---

### 1.3 서비스 접속 확인 (10분)

#### 절차:

1. **브라우저에서 로드밸런서 IP 접속**

   ```
   http://136.110.134.8/
   ```

2. **로그인 페이지 확인**

   - 페이지가 정상적으로 로드되는지 확인
   - 디자인이 제대로 표시되는지 확인

3. **회원가입 테스트**

   ```
   이메일: test@example.com
   비밀번호: test1234
   이름: 테스트사용자
   전화번호: 010-1234-5678
   ```

   - 회원가입 버튼 클릭
   - 성공 메시지 확인

4. **로그인 테스트**

   ```
   이메일: test@example.com
   비밀번호: test1234
   ```

   - 로그인 버튼 클릭
   - 메인 페이지로 이동 확인

5. **경기 목록 확인**

   - 경기 목록이 표시되는지 확인
   - 데이터베이스 연결 정상 확인

6. **모니터링 위젯 확인**
   - 오른쪽 상단 모니터링 위젯 표시 확인
   - CPU, 메모리, 활성 인스턴스 표시 확인
   - **활성 인스턴스: 2개** 확인

#### 확인 사항:

- ✅ 로그인 페이지 정상 로드
- ✅ 회원가입 성공
- ✅ 로그인 성공
- ✅ 경기 목록 표시
- ✅ 모니터링 위젯 작동
- ✅ 활성 인스턴스 2개 표시

---

### 1.4 스크린샷 도구 준비

#### Windows:

- **Snipping Tool** 또는 **Win + Shift + S**
- 저장 폴더 미리 생성: `C:\Screenshots\football-test\`

#### Mac:

- **Cmd + Shift + 4** (영역 선택)
- 저장 폴더 미리 생성: `~/Screenshots/football-test/`

#### 브라우저:

- **F12** (개발자 도구)
- 스크린샷 기능 활용

---

## 📸 Step 2: 초기 상태 스크린샷 촬영 (10분)

### 2.1 스크린샷 01: 인스턴스 그룹 초기 상태

#### 촬영 위치:

```
GCP Console → Compute Engine → 인스턴스 그룹 → football-app-group-v2 → 멤버 탭
```

#### 촬영 내용:

- 인스턴스 2개 표시
- 각 인스턴스 이름, 내부 IP, 상태
- 생성 시간
- 템플릿 이름

#### 파일명:

```
01-initial-instances-2.png
```

#### 체크리스트:

- [ ] 인스턴스 2개 모두 보임
- [ ] 상태: 정상 (초록색 체크)
- [ ] 내부 IP: 10.0.1.x
- [ ] 날짜/시간 표시

---

### 2.2 스크린샷 02: CPU 사용률 초기 상태

#### 촬영 위치:

```
인스턴스 그룹 → 모니터링 탭
```

#### 촬영 내용:

- CPU 사용률 그래프
- 시간 범위: 최근 1시간
- 평균 CPU 사용률 (낮은 상태)

#### 파일명:

```
02-initial-cpu-low.png
```

#### 체크리스트:

- [ ] CPU 그래프 보임
- [ ] 사용률 0-5% 범위
- [ ] 시간 축 명확
- [ ] 그래프 전체 보임

---

### 2.3 스크린샷 03: 웹 모니터링 위젯

#### 촬영 위치:

```
http://136.110.134.8/ (로그인 후)
```

#### 촬영 내용:

- 모니터링 위젯 전체
- CPU 사용률
- 메모리 사용률
- **활성 인스턴스: 2개**
- 서버 이름
- 가동 시간

#### 파일명:

```
03-widget-initial-2-instances.png
```

#### 체크리스트:

- [ ] 위젯 전체 보임
- [ ] 활성 인스턴스: 2개 명확
- [ ] CPU, 메모리 값 표시
- [ ] 서버 이름 보임

---

## 🚀 Step 3: 부하 테스트 시작 (20-30분)

### 3.1 Phase 1: 로그인 페이지 부하 테스트 (5분)

#### 절차:

1. **로그아웃**

   - 오른쪽 상단 로그아웃 버튼 클릭
   - 로그인 페이지로 이동 확인

2. **모니터링 위젯 확인**

   - 로그인 페이지에서도 위젯 표시 확인
   - 현재 상태 확인

3. **부하 테스트 시작**

   - 모니터링 위젯 하단 **🚀 부하 시작** 버튼 클릭
   - 메시지 확인: "🔐 대량 회원가입/로그인 시뮬레이션 중..."

4. **통계 관찰**
   - 사용자 수 증가 확인
   - 성공/실패 카운트 증가 확인
   - 1-2분 관찰

#### 스크린샷 04: 로그인 부하 테스트

```
파일명: 04-login-load-test-running.png
```

#### 촬영 내용:

- 모니터링 위젯
- 부하 테스트 메시지
- 통계 (사용자, 성공, 실패)
- CPU 사용률 증가

#### 기록 사항:

```
시작 시간: __:__
초당 요청 수: 500개
시나리오: 회원가입 50%, 로그인 50%
```

---

### 3.2 Phase 2: GCP Console CPU 모니터링 (동시 진행)

#### 절차:

1. **새 탭에서 GCP Console 열기**

   - 웹 페이지는 그대로 두고 새 탭 열기

2. **인스턴스 그룹 모니터링 탭 이동**

   ```
   Compute Engine → 인스턴스 그룹 → football-app-group-v2 → 모니터링 탭
   ```

3. **CPU 사용률 관찰**
   - 그래프가 급상승하는지 확인
   - 10% 목표치 초과 확인
   - 새로고침하며 관찰

#### 스크린샷 05: CPU 사용률 증가

```
파일명: 05-cpu-increase-above-target.png
```

#### 촬영 타이밍:

- CPU 사용률이 10% 이상 올라갔을 때
- 부하 시작 후 약 1-2분

#### 기록 사항:

```
부하 시작 후 경과 시간: __분 __초
CPU 사용률: __%
목표 CPU (10%) 초과 확인: ✅
```

---

### 3.3 Phase 3: 첫 번째 확장 관찰 (2-3분)

#### 절차:

1. **멤버 탭으로 이동**

   ```
   인스턴스 그룹 → 멤버 탭
   ```

2. **새로고침하며 관찰**

   - 30초마다 새로고침 (F5)
   - 인스턴스 개수 변화 확인

3. **3개로 확장 확인**
   - 새 인스턴스 생성 확인
   - 상태가 "정상"으로 변경될 때까지 대기

#### 스크린샷 06: 인스턴스 3개로 확장

```
파일명: 06-autoscale-to-3-instances.png
```

#### 촬영 타이밍:

- 인스턴스가 3개가 되고 모두 정상 상태일 때

#### 기록 사항:

```
확장 시간: 부하 시작 후 __분 __초
새 인스턴스 ID: _______________
상태: 정상 ✅
```

---

### 3.4 Phase 4: 웹 페이지에서 확인

#### 절차:

1. **웹 페이지 탭으로 돌아가기**

   - 부하 테스트가 계속 실행 중인 탭

2. **모니터링 위젯 확인**
   - **활성 인스턴스: 3개** 표시 확인
   - 자동으로 업데이트됨 (2초마다)

#### 스크린샷 07: 웹 위젯 3개 확인

```
파일명: 07-widget-3-instances.png
```

#### 촬영 내용:

- 모니터링 위젯
- 활성 인스턴스: 3개
- 부하 테스트 계속 진행 중
- 통계 증가 중

---

### 3.5 Phase 5: 두 번째 확장 (2-3분)

#### 절차:

1. **GCP Console 멤버 탭 계속 관찰**

   - 30초마다 새로고침
   - 4개로 확장되는지 확인

2. **4개 확장 확인**

#### 스크린샷 08: 인스턴스 4개로 확장

```
파일명: 08-autoscale-to-4-instances.png
```

#### 기록 사항:

```
확장 시간: 부하 시작 후 __분 __초
이전 확장 후 경과: __분 __초
```

---

### 3.6 Phase 6: 세 번째 확장 (최대) (2-3분)

#### 절차:

1. **계속 관찰**

   - 5개로 확장되는지 확인
   - 최대값 도달

2. **5개 확장 확인**

#### 스크린샷 09: 인스턴스 5개로 확장 (최대)

```
파일명: 09-autoscale-to-5-max-instances.png
```

#### 기록 사항:

```
확장 시간: 부하 시작 후 __분 __초
총 확장 시간: __분 __초
최대 인스턴스 도달 ✅
```

---

### 3.7 Phase 7: 웹 페이지 최종 확인

#### 스크린샷 10: 웹 위젯 5개 확인

```
파일명: 10-widget-5-max-instances.png
```

#### 촬영 내용:

- 활성 인스턴스: 5개
- 부하 테스트 통계 (높은 숫자)
- CPU, 메모리 사용률

---

### 3.8 Phase 8: 로드밸런서 모니터링

#### 절차:

1. **로드밸런서 페이지로 이동**

   ```
   네트워크 서비스 → 부하 분산 → football-load-balancer
   ```

2. **모니터링 탭 확인**
   - 요청 수 그래프
   - 백엔드 지연 시간
   - 시간 범위: 최근 1시간

#### 스크린샷 11: 로드밸런서 트래픽

```
파일명: 11-loadbalancer-traffic-spike.png
```

#### 촬영 내용:

- 요청 수 그래프 (급증)
- 백엔드 지연 시간
- 시간 축

---

### 3.9 Phase 9: 백엔드 상태 확인

#### 절차:

1. **백엔드 탭으로 이동**

   ```
   로드밸런서 → 백엔드 탭
   ```

2. **백엔드 서비스 확인**
   - football-backend-service 클릭
   - 백엔드 그룹 확인

#### 스크린샷 12: 백엔드 5개 HEALTHY

```
파일명: 12-backend-5-healthy-instances.png
```

#### 촬영 내용:

- 백엔드 그룹: football-app-group-v2
- 인스턴스 5개 모두 HEALTHY
- 용량 100%

---

## 🛑 Step 4: 부하 중지 및 스케일 다운 (15-20분)

### 4.1 부하 테스트 중지

#### 절차:

1. **웹 페이지로 돌아가기**

   - 부하 테스트 실행 중인 탭

2. **부하 중지 버튼 클릭**

   - **⏹️ 부하 중지** 버튼 클릭

3. **완료 메시지 확인**
   - 총 사용자 수 확인
   - 성공/실패 통계 확인

#### 스크린샷 13: 부하 테스트 완료

```
파일명: 13-load-test-completed-stats.png
```

#### 기록 사항:

```
총 사용자 수: _______명
성공: _______개 (__%)
실패: _______개 (__%)
테스트 지속 시간: __분 __초
```

---

### 4.2 CPU 사용률 감소 관찰

#### 절차:

1. **GCP Console 모니터링 탭**

   - CPU 사용률 그래프 확인
   - 하락하는지 관찰

2. **10% 이하 도달 확인**

#### 스크린샷 14: CPU 감소

```
파일명: 14-cpu-decrease-after-stop.png
```

#### 기록 사항:

```
부하 중지 후 경과: __분 __초
CPU 사용률: __%
목표치 이하 도달: ✅
```

---

### 4.3 스케일 다운 관찰 (10-20분)

#### 절차:

1. **멤버 탭 계속 관찰**

   - 1-2분마다 새로고침
   - 인스턴스 개수 감소 확인

2. **2개로 축소 확인**
   - 최소값 도달

#### 스크린샷 15: 인스턴스 2개로 축소

```
파일명: 15-autoscale-down-to-2-min.png
```

#### 기록 사항:

```
축소 시작: 부하 중지 후 __분
총 축소 시간: __분
최소 인스턴스 도달: ✅
```

---

## 📊 Step 5: 인프라 구성 스크린샷 (10분)

### 5.1 VPC 네트워크

#### 촬영 위치:

```
VPC 네트워크 → VPC 네트워크 → football-vpc
```

#### 스크린샷 16: VPC 및 서브넷

```
파일명: 16-vpc-network-subnets.png
```

---

### 5.2 방화벽 규칙

#### 촬영 위치:

```
VPC 네트워크 → 방화벽
```

#### 스크린샷 17: 방화벽 규칙

```
파일명: 17-firewall-rules-list.png
```

---

### 5.3 Cloud NAT

#### 촬영 위치:

```
네트워크 서비스 → Cloud NAT
```

#### 스크린샷 18: Cloud NAT

```
파일명: 18-cloud-nat-gateway.png
```

---

### 5.4 서비스 계정

#### 촬영 위치:

```
IAM 및 관리자 → 서비스 계정
```

#### 스크린샷 19: 서비스 계정

```
파일명: 19-service-account-roles.png
```

---

### 5.5 Cloud SQL

#### 촬영 위치:

```
SQL → 인스턴스 선택
```

#### 스크린샷 20: Cloud SQL

```
파일명: 20-cloud-sql-instance.png
```

---

## ✅ Step 6: 최종 확인 및 정리

### 6.1 스크린샷 확인

#### 체크리스트:

- [ ] 총 20개 스크린샷 촬영 완료
- [ ] 파일명 규칙 준수
- [ ] 모든 이미지 선명하게 촬영
- [ ] 중요 정보 가려지지 않음

### 6.2 데이터 기록 확인

#### 타이밍 데이터:

```
부하 시작: __:__
CPU 10% 초과: __:__ (경과 __분)
2→3개 확장: __:__ (경과 __분)
3→4개 확장: __:__ (경과 __분)
4→5개 확장: __:__ (경과 __분)
부하 중지: __:__
5→2개 축소: __:__ (경과 __분)
```

#### 통계 데이터:

```
총 사용자 수: _______명
성공 요청: _______개
실패 요청: _______개
성공률: _______%
```

### 6.3 리소스 정리 (선택사항)

#### 크레딧 절약을 위해:

1. **인스턴스 그룹 중지**

   - 최소/최대 0으로 설정

2. **Cloud SQL 중지**
   - 중지 버튼 클릭

---

## 📝 다음 단계

### 보고서 작성:

1. 스크린샷 정리 및 폴더 분류
2. 데이터 분석 및 표 작성
3. 그래프 생성
4. 보고서 작성 시작

---

## ⚠️ 주의사항

### 테스트 중:

- ✅ 각 단계마다 시간 기록
- ✅ 스크린샷 즉시 저장
- ✅ 이상 현상 발생 시 메모
- ✅ 여러 번 새로고침하며 확인

### 스크린샷:

- ✅ 고해상도로 촬영
- ✅ 전체 화면 또는 관련 영역
- ✅ 날짜/시간 포함
- ✅ 중요 부분 명확하게

### 문제 발생 시:

- ✅ 에러 메시지 스크린샷
- ✅ 로그 확인
- ✅ 문제 해결 과정 기록
- ✅ 해결 후 재테스트

---

## 🎯 성공 기준

### 필수 달성:

- ✅ 인스턴스 2개 → 5개 확장
- ✅ 인스턴스 5개 → 2개 축소
- ✅ 모든 스크린샷 촬영
- ✅ 타이밍 데이터 기록

### 목표 달성:

- ✅ 확장 시간 < 5분
- ✅ 축소 시간 < 20분
- ✅ 에러율 < 5%
- ✅ 서비스 중단 없음

---

이 절차대로 진행하면 완벽한 테스트 결과를 얻을 수 있습니다! 🚀
